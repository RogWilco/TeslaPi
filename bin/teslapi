#!/usr/bin/env bash

DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )/../" && pwd )"
cd "$DIR" || exit 1

DIR_MODULES="${DIR}/modules"

# Imports
source "${DIR}/lib/out.sh"

out "@ENTRY"
out "@H1 TeslaPi"

# ============================================================================
# Process Subcommand/Module
# ============================================================================

SUB_COMMAND="$1"
SUB_FILE="$1"

if [[ -f "${DIR_MODULES}/${SUB_COMMAND}.sh" ]]; then
    SUB_FILE="${SUB_COMMAND}.sh"
elif [[ -f "${DIR_MODULES}/${SUB_COMMAND}/index.sh" ]]; then
    SUB_FILE="${SUB_COMMAND}/index.sh"
else
    SUB_FILE="help.sh"
fi

shift 1
source "${DIR_MODULES}/${SUB_FILE}"
eval "${SUB_COMMAND}::index \"$@\""

out "@EXIT"
